name: ðŸš€ Deploy Frontend to AWS (Apache)

on:
  push:
    branches:
      - main  # ç›‘å¬ main åˆ†æ”¯çš„ push äº‹ä»¶

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: ðŸš€ æ£€å‡ºä»£ç 
        uses: actions/checkout@v3

      - name: ðŸ”§ å®‰è£… Node.js å¹¶æž„å»ºå‰ç«¯
        run: |
          sudo apt update
          sudo apt install -y nodejs npm
          npm install
          npm run build  # ç”Ÿæˆå‰ç«¯é™æ€æ–‡ä»¶ï¼ˆReact: `build/`ï¼ŒVue: `dist/`ï¼‰

      - name: ðŸ”‘ é…ç½® SSH è¿žæŽ¥
        run: |
          echo "${{ secrets.AWS_EC2_SSH_KEY }}" > private_key.pem
          chmod 600 private_key.pem

      - name: ðŸ“‚ éƒ¨ç½²åˆ° AWS EC2ï¼ˆApacheï¼‰
        run: |
          scp -o StrictHostKeyChecking=no -i private_key.pem -r build/* ${{ secrets.AWS_EC2_USER }}@${{ secrets.AWS_EC2_HOST }}:/var/www/frontend
          ssh -o StrictHostKeyChecking=no -i private_key.pem ${{ secrets.AWS_EC2_USER }}@${{ secrets.AWS_EC2_HOST }} << 'EOF'
            sudo systemctl restart apache2  # é‡æ–°å¯åŠ¨ Apache
          EOF
